import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

export type LangCode = 'en' | 'hi' | 'es' | 'fr' | 'de';

// Minimal translation dictionaries. Expand as needed.
const dictionaries: Record<LangCode, Record<string, string>> = {
  en: {
    'nav.home': 'Home',
    'nav.problems': 'Problems',
    'nav.contests': 'Contests',
    'nav.discuss': 'Discuss',
    'nav.leaderboard': 'Leaderboard',
    'nav.company': 'Company',
    'nav.contact': 'Contact',
    'nav.wallet': 'Wallet',
    'settings.title': 'Settings',
    'settings.preferences.language': 'Language',
    // Login page
    'login.title': 'Welcome Back',
    'login.subtitle': 'Sign in to <b>AlgoBucks</b>',
    'login.email': 'Email Address',
    'login.password': 'Password',
    'login.remember': 'Remember me',
    'login.forgot': 'Forgot password?',
    'login.submit': 'Sign In to AlgoBucks',
    'login.continue_with': 'Or continue with',
    'login.no_account': "Don't have an account?",
    'login.create_here': 'Create one here',
    'login.error.fill_all': 'Please fill in all fields',
    'login.error.invalid': 'Invalid email or password',
    'login.success': 'You have been successfully logged in.',
    // Common / Header / Footer
    'common.company': 'Company',
    'common.about': 'About',
    'common.about_us': 'About Us',
    'common.careers': 'Careers',
    'common.press': 'Press',
    'common.contact': 'Contact',
    'common.blog': 'Blog',
    'common.help_center': 'Help Center',
    'common.community': 'Community',
    'common.stay_connected': 'Stay Connected',
    'common.subscribe_newsletter': 'Subscribe Newsletter',
    'common.join_community': 'Join Community',
    'common.legal': 'Legal',
    'common.terms': 'Terms of Service',
    'common.privacy': 'Privacy Policy',
    'common.cookies': 'Cookie Policy',
    'common.all_rights_reserved': 'All rights reserved.',
    'auth.login': 'Log in',
    'auth.signup': 'Sign Up',
    'auth.create_free_account': 'Create Free Account',
    'user.your_profile': 'Your Profile',
    'user.settings': 'Settings',
    'user.admin_panel': 'Admin Panel',
    'user.admin': 'Admin',
    'user.sign_out': 'Sign out',
    'stats.coins': 'Coins',
    'stats.wallet': 'Wallet',
    'stats.points': 'Points',
    // Leaderboard
    'leaderboard.title': 'AlgoBucks Leaderboard',
    'leaderboard.search_placeholder': 'Search by username or name...',
    'leaderboard.sort_name': 'Name',
    'leaderboard.solved': 'Solved',
    'leaderboard.subtitle': 'Top performers and their achievements',
    'leaderboard.subtitle2': 'Compete and climb the ranks to earn more AlgoBucks',
    'leaderboard.full_rankings': 'Full Rankings',
    'leaderboard.no_users': 'No users found matching your search',
    'leaderboard.clear_search': 'Clear Search',
    // Home
    'home.hero.tagline': 'Think smart. Code harder. Earn more.',
    'home.hero.subtitle': 'The ultimate platform for algorithmic traders to compete, earn, and grow their skills. Develop winning strategies, earn AlgoBucks, and cash out your success.',
    'home.btn.start_coding': 'Start Coding',
    'home.btn.join_contest': 'Join Contest',
    'home.btn.create_account': 'Create Free Account',
    'home.stats.active_coders': 'Active Coders',
    'home.stats.problems_solved': 'Problems Solved',
    'home.stats.total_prizes': 'Total Prizes Won',
    'home.stats.live_contests': 'Live Contests',
    'home.why.title': 'Why Choose AlgoBucks?',
    'home.why.subtitle': "More than just coding practice - it's a complete ecosystem where your skills earn you real rewards and recognition.",
    'home.features.realtime.title': 'Real-time Coding',
    'home.features.realtime.desc': 'Code in your browser with instant feedback and lightning-fast execution',
    'home.features.earn_money.title': 'Earn Real Money',
    'home.features.earn_money.desc': 'Convert your coding skills into cash rewards through contests and challenges',
    'home.features.matching.title': 'Skill-based Matching',
    'home.features.matching.desc': 'Compete against developers of similar skill levels for fair competition',
    'home.features.ai.title': 'AI-Powered Learning',
    'home.features.ai.desc': 'Get personalized problem recommendations based on your coding patterns',
    'home.how.title': 'How It Works',
    'home.how.subtitle': 'Simple steps to start earning',
    'home.how.step1.title': 'Solve Problems',
    'home.how.step1.desc': 'Complete coding challenges and earn 1 codecoin per solved problem',
    'home.how.step2.title': 'Join Contests',
    'home.how.step2.desc': 'Participate in paid contests and compete for cash prizes',
    'home.how.step3.title': 'Win & Withdraw',
    'home.how.step3.desc': 'Win contests and withdraw your earnings to your bank account',
    'home.cta.title': 'Ready to Start Earning with Code?',
    'home.cta.subtitle': 'Join thousands of developers who are already earning with AlgoBucks',
    'home.cta.get_started': 'Get Started Now',
    'home.cta.browse_contests': 'Browse Contests',
    // Public Profile
    'profile.codecoins': 'Codecoins',
    'profile.points': 'Points',
    'profile.rank': 'Leaderboard Rank',
    'profile.solved': 'Solved',
    'profile.recent_solved': 'Recent Solved Problems',
    'profile.recent_contests': 'Recent Contests',
    'profile.user_not_found': 'User not found',
    'profile.back_to_leaderboard': 'Back to Leaderboard',
    // Settings basic
    'settings.subtitle': 'Manage your account and preferences',
    'settings.tab.account': 'Account',
    'settings.tab.notifications': 'Notifications',
    'settings.tab.privacy': 'Privacy',
    'settings.tab.preferences': 'Preferences',
  },
  hi: {
    'nav.home': 'मुखपृष्ठ',
    'nav.problems': 'समस्याएँ',
    'nav.contests': 'प्रतियोगिताएँ',
    'nav.discuss': 'चर्चा',
    'nav.leaderboard': 'लीडरबोर्ड',
    'nav.company': 'कंपनी',
    'nav.contact': 'संपर्क',
    'nav.wallet': 'वॉलेट',
    'settings.title': 'सेटिंग्स',
    'settings.preferences.language': 'भाषा',
    // Login page
    'login.title': 'वापसी पर स्वागत है',
    'login.subtitle': '<b>AlgoBucks</b> में साइन इन करें',
    'login.email': 'ईमेल पता',
    'login.password': 'पासवर्ड',
    'login.remember': 'मुझे याद रखें',
    'login.forgot': 'पासवर्ड भूल गए?',
    'login.submit': 'AlgoBucks में साइन इन करें',
    'login.continue_with': 'या जारी रखें',
    'login.no_account': 'खाता नहीं है?',
    'login.create_here': 'यहाँ बनाएँ',
    'login.error.fill_all': 'कृपया सभी फ़ील्ड भरें',
    'login.error.invalid': 'अमान्य ईमेल या पासवर्ड',
    'login.success': 'आप सफलतापूर्वक लॉग इन हो गए हैं।',
    // Common / Header / Footer
    'common.company': 'कंपनी',
    'common.about': 'परिचय',
    'common.about_us': 'हमारे बारे में',
    'common.careers': 'करियर',
    'common.press': 'प्रेस',
    'common.contact': 'संपर्क',
    'common.blog': 'ब्लॉग',
    'common.help_center': 'सहायता केंद्र',
    'common.community': 'समुदाय',
    'common.stay_connected': 'जुड़े रहें',
    'common.subscribe_newsletter': 'न्यूज़लेटर सदस्यता लें',
    'common.join_community': 'समुदाय से जुड़ें',
    'common.legal': 'कानूनी',
    'common.terms': 'सेवा की शर्तें',
    'common.privacy': 'गोपनीयता नीति',
    'common.cookies': 'कुकी नीति',
    'common.all_rights_reserved': 'सर्वाधिकार सुरक्षित।',
    'auth.login': 'लॉग इन',
    'auth.signup': 'साइन अप',
    'auth.create_free_account': 'मुफ्त खाता बनाएं',
    'user.your_profile': 'आपकी प्रोफ़ाइल',
    'user.settings': 'सेटिंग्स',
    'user.admin_panel': 'एडमिन पैनल',
    'user.admin': 'एडमिन',
    'user.sign_out': 'साइन आउट',
    'stats.coins': 'कॉइन्स',
    'stats.wallet': 'वॉलेट',
    'stats.points': 'अंक',
    // Leaderboard
    'leaderboard.title': 'AlgoBucks लीडरबोर्ड',
    'leaderboard.search_placeholder': 'उपयोगकर्ता नाम या नाम से खोजें...',
    'leaderboard.sort_name': 'नाम',
    'leaderboard.solved': 'हल किए',
    'leaderboard.subtitle': 'श्रेष्ठ प्रदर्शनकर्ता और उनकी उपलब्धियाँ',
    'leaderboard.subtitle2': 'प्रतिस्पर्धा करें और अधिक AlgoBucks पाने के लिए रैंकों में ऊपर चढ़ें',
    'leaderboard.full_rankings': 'पूर्ण रैंकिंग',
    'leaderboard.no_users': 'आपकी खोज से मेल खाने वाले कोई उपयोगकर्ता नहीं मिले',
    'leaderboard.clear_search': 'खोज साफ़ करें',
    // Home
    'home.hero.tagline': 'सोचिए समझदारी से। कोड कीजिए मेहनत से। कमाइए ज़्यादा।',
    'home.hero.subtitle': 'एल्गोरिथमिक ट्रेडर्स के लिए प्रतियोगिता, कमाई और कौशल बढ़ाने का बेहतरीन प्लेटफ़ॉर्म। विजेता रणनीतियाँ बनाएं, AlgoBucks कमाएँ और अपनी कमाई निकालें।',
    'home.btn.start_coding': 'कोडिंग शुरू करें',
    'home.btn.join_contest': 'प्रतियोगिता में शामिल हों',
    'home.btn.create_account': 'मुफ़्त खाता बनाएँ',
    'home.stats.active_coders': 'सक्रिय कोडर्स',
    'home.stats.problems_solved': 'हल की गई समस्याएँ',
    'home.stats.total_prizes': 'जीते गए कुल इनाम',
    'home.stats.live_contests': 'लाइव प्रतियोगिताएँ',
    'home.why.title': 'AlgoBucks क्यों चुनें?',
    'home.why.subtitle': 'सिर्फ़ कोडिंग प्रैक्टिस नहीं — यह एक पूरा इकोसिस्टम है जहाँ आपके कौशल को असली इनाम और पहचान मिलती है।',
    'home.features.realtime.title': 'रीयल-टाइम कोडिंग',
    'home.features.realtime.desc': 'ब्राउज़र में तुरंत प्रतिक्रिया और तेज़ निष्पादन के साथ कोड करें',
    'home.features.earn_money.title': 'असली पैसे कमाएँ',
    'home.features.earn_money.desc': 'प्रतियोगिताओं और चुनौतियों के माध्यम से अपनी कोडिंग स्किल्स को नकद इनाम में बदलें',
    'home.features.matching.title': 'कौशल-आधारित मैचिंग',
    'home.features.matching.desc': 'निष्पक्ष मुकाबले के लिए समान कौशल वाले डेवलपर्स के साथ प्रतिस्पर्धा करें',
    'home.features.ai.title': 'एआई-संचालित लर्निंग',
    'home.features.ai.desc': 'आपकी कोडिंग पैटर्न के आधार पर व्यक्तिगत समस्या अनुशंसाएँ प्राप्त करें',
    'home.how.title': 'यह कैसे काम करता है',
    'home.how.subtitle': 'कमाई शुरू करने के आसान चरण',
    'home.how.step1.title': 'समस्याएँ हल करें',
    'home.how.step1.desc': 'कोडिंग चुनौतियाँ पूरी करें और हर समस्या पर 1 कोडकॉइन पाएं',
    'home.how.step2.title': 'प्रतियोगिताओं में शामिल हों',
    'home.how.step2.desc': 'पेड प्रतियोगिताओं में भाग लें और नकद इनाम के लिए प्रतिस्पर्धा करें',
    'home.how.step3.title': 'जीतें और निकालेँ',
    'home.how.step3.desc': 'प्रतियोगिताएँ जीतें और अपनी कमाई बैंक खाते में निकालें',
    'home.cta.title': 'कोड से कमाई शुरू करने के लिए तैयार?',
    'home.cta.subtitle': 'हज़ारों डेवलपर्स से जुड़ें जो पहले से AlgoBucks के साथ कमा रहे हैं',
    'home.cta.get_started': 'अभी शुरू करें',
    'home.cta.browse_contests': 'प्रतियोगिताएँ देखें',
    // Public Profile
    'profile.codecoins': 'कोडकॉइन्स',
    'profile.points': 'अंक',
    'profile.rank': 'लीडरबोर्ड रैंक',
    'profile.solved': 'हल किए',
    'profile.recent_solved': 'हाल ही में हल की गई समस्याएँ',
    'profile.recent_contests': 'हाल की प्रतियोगिताएँ',
    'profile.user_not_found': 'उपयोगकर्ता नहीं मिला',
    'profile.back_to_leaderboard': 'लीडरबोर्ड पर वापस जाएँ',
    // Settings basic
    'settings.subtitle': 'अपने खाते और प्राथमिकताओं का प्रबंधन करें',
    'settings.tab.account': 'खाता',
    'settings.tab.notifications': 'सूचनाएँ',
    'settings.tab.privacy': 'गोपनीयता',
    'settings.tab.preferences': 'प्राथमिकताएँ',
  },
  es: {
    'nav.home': 'Inicio',
    'nav.problems': 'Problemas',
    'nav.contests': 'Concursos',
    'nav.discuss': 'Debate',
    'nav.leaderboard': 'Clasificación',
    'nav.company': 'Compañía',
    'nav.contact': 'Contacto',
    'nav.wallet': 'Billetera',
    'settings.title': 'Configuración',
    'settings.preferences.language': 'Idioma',
    // Login page
    'login.title': 'Bienvenido de nuevo',
    'login.subtitle': 'Inicia sesión en <b>AlgoBucks</b>',
    'login.email': 'Correo electrónico',
    'login.password': 'Contraseña',
    'login.remember': 'Recuérdame',
    'login.forgot': '¿Olvidaste tu contraseña?',
    'login.submit': 'Iniciar sesión en AlgoBucks',
    'login.continue_with': 'O continúa con',
    'login.no_account': '¿No tienes una cuenta?',
    'login.create_here': 'Crea una aquí',
    'login.error.fill_all': 'Por favor completa todos los campos',
    'login.error.invalid': 'Correo o contraseña inválidos',
    'login.success': 'Has iniciado sesión correctamente.',
    // Common / Header / Footer
    'common.company': 'Compañía',
    'common.about': 'Acerca de',
    'common.about_us': 'Sobre nosotros',
    'common.careers': 'Empleos',
    'common.press': 'Prensa',
    'common.contact': 'Contacto',
    'common.blog': 'Blog',
    'common.help_center': 'Centro de ayuda',
    'common.community': 'Comunidad',
    'common.stay_connected': 'Mantente conectado',
    'common.subscribe_newsletter': 'Suscribirse al boletín',
    'common.join_community': 'Unirse a la comunidad',
    'common.legal': 'Legal',
    'common.terms': 'Términos de servicio',
    'common.privacy': 'Política de privacidad',
    'common.cookies': 'Política de cookies',
    'common.all_rights_reserved': 'Todos los derechos reservados.',
    'auth.login': 'Iniciar sesión',
    'auth.signup': 'Regístrate',
    'auth.create_free_account': 'Crear cuenta gratis',
    'user.your_profile': 'Tu perfil',
    'user.settings': 'Configuraciones',
    'user.admin_panel': 'Panel de administración',
    'user.admin': 'Admin',
    'user.sign_out': 'Cerrar sesión',
    'stats.coins': 'Monedas',
    'stats.wallet': 'Billetera',
    'stats.points': 'Puntos',
  },
  fr: {
    'nav.home': 'Accueil',
    'nav.problems': 'Problèmes',
    'nav.contests': 'Concours',
    'nav.discuss': 'Discussion',
    'nav.leaderboard': 'Classement',
    'nav.company': 'Entreprise',
    'nav.contact': 'Contact',
    'nav.wallet': 'Portefeuille',
    'settings.title': 'Paramètres',
    'settings.preferences.language': 'Langue',
    // Login page
    'login.title': 'Bon retour',
    'login.subtitle': 'Connectez-vous à <b>AlgoBucks</b>',
    'login.email': 'Adresse e-mail',
    'login.password': 'Mot de passe',
    'login.remember': 'Se souvenir de moi',
    'login.forgot': 'Mot de passe oublié ?',
    'login.submit': "Se connecter à AlgoBucks",
    'login.continue_with': 'Ou continuer avec',
    'login.no_account': "Vous n'avez pas de compte ?",
    'login.create_here': 'Créez-en un ici',
    'login.error.fill_all': 'Veuillez remplir tous les champs',
    'login.error.invalid': 'E-mail ou mot de passe invalide',
    'login.success': 'Connexion réussie.',
    // Common / Header / Footer
    'common.company': 'Entreprise',
    'common.about': 'À propos',
    'common.about_us': 'À propos de nous',
    'common.careers': 'Carrières',
    'common.press': 'Presse',
    'common.contact': 'Contact',
    'common.blog': 'Blog',
    'common.help_center': 'Centre d’aide',
    'common.community': 'Communauté',
    'common.stay_connected': 'Restez connecté',
    'common.subscribe_newsletter': 'S’abonner à la newsletter',
    'common.join_community': 'Rejoindre la communauté',
    'common.legal': 'Mentions légales',
    'common.terms': 'Conditions d’utilisation',
    'common.privacy': 'Politique de confidentialité',
    'common.cookies': 'Politique de cookies',
    'common.all_rights_reserved': 'Tous droits réservés.',
    'auth.login': 'Se connecter',
    'auth.signup': 'S’inscrire',
    'auth.create_free_account': 'Créer un compte gratuit',
    'user.your_profile': 'Votre profil',
    'user.settings': 'Paramètres',
    'user.admin_panel': 'Panneau d’administration',
    'user.admin': 'Admin',
    'user.sign_out': 'Se déconnecter',
    'stats.coins': 'Pièces',
    'stats.wallet': 'Portefeuille',
    'stats.points': 'Points',
  },
  de: {
    'nav.home': 'Startseite',
    'nav.problems': 'Aufgaben',
    'nav.contests': 'Wettbewerbe',
    'nav.discuss': 'Diskutieren',
    'nav.leaderboard': 'Bestenliste',
    'nav.company': 'Unternehmen',
    'nav.contact': 'Kontakt',
    'nav.wallet': 'Wallet',
    'settings.title': 'Einstellungen',
    'settings.preferences.language': 'Sprache',
    // Login page
    'login.title': 'Willkommen zurück',
    'login.subtitle': 'Bei <b>AlgoBucks</b> anmelden',
    'login.email': 'E-Mail-Adresse',
    'login.password': 'Passwort',
    'login.remember': 'Angemeldet bleiben',
    'login.forgot': 'Passwort vergessen?',
    'login.submit': 'Bei AlgoBucks anmelden',
    'login.continue_with': 'Oder fortfahren mit',
    'login.no_account': 'Noch kein Konto?',
    'login.create_here': 'Hier erstellen',
    'login.error.fill_all': 'Bitte alle Felder ausfüllen',
    'login.error.invalid': 'Ungültige E-Mail oder Passwort',
    'login.success': 'Sie wurden erfolgreich angemeldet.',
    // Common / Header / Footer
    'common.company': 'Unternehmen',
    'common.about': 'Über',
    'common.about_us': 'Über uns',
    'common.careers': 'Karriere',
    'common.press': 'Presse',
    'common.contact': 'Kontakt',
    'common.blog': 'Blog',
    'common.help_center': 'Hilfe-Center',
    'common.community': 'Community',
    'common.stay_connected': 'Verbunden bleiben',
    'common.subscribe_newsletter': 'Newsletter abonnieren',
    'common.join_community': 'Community beitreten',
    'common.legal': 'Rechtliches',
    'common.terms': 'Nutzungsbedingungen',
    'common.privacy': 'Datenschutzerklärung',
    'common.cookies': 'Cookie-Richtlinie',
    'common.all_rights_reserved': 'Alle Rechte vorbehalten.',
    'auth.login': 'Anmelden',
    'auth.signup': 'Registrieren',
    'auth.create_free_account': 'Kostenloses Konto erstellen',
    'user.your_profile': 'Dein Profil',
    'user.settings': 'Einstellungen',
    'user.admin_panel': 'Admin-Bereich',
    'user.admin': 'Admin',
    'user.sign_out': 'Abmelden',
    'stats.coins': 'Münzen',
    'stats.wallet': 'Wallet',
    'stats.points': 'Punkte',
  },
};

interface I18nContextValue {
  lang: LangCode;
  setLanguage: (lang: LangCode) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

export const I18nProvider: React.FC<{ initialLang?: LangCode; children: React.ReactNode }> = ({ initialLang, children }) => {
  const [lang, setLang] = useState<LangCode>(() => {
    const saved = (localStorage.getItem('lang') as LangCode | null) || undefined;
    return initialLang || saved || 'en';
  });

  useEffect(() => {
    localStorage.setItem('lang', lang);
    try {
      document.documentElement.lang = lang;
    } catch {}
  }, [lang]);

  const t = useMemo(() => {
    const dict = dictionaries[lang] || dictionaries.en;
    return (key: string) => dict[key] ?? key;
  }, [lang]);

  const setLanguage = (next: LangCode) => setLang(next);

  const value: I18nContextValue = { lang, setLanguage, t };
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}
