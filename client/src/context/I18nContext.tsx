import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

export type LangCode = 'en' | 'hi' | 'es' | 'fr' | 'de';

// Minimal translation dictionaries. Expand as needed.
const dictionaries: Record<LangCode, Record<string, string>> = {
  en: {
    'nav.home': 'Home',
    'nav.problems': 'Problems',
    'nav.contests': 'Contests',
    'nav.discuss': 'Discuss',
    'nav.leaderboard': 'Leaderboard',
    'nav.company': 'Company',
    'nav.contact': 'Contact',
    'nav.wallet': 'Wallet',
    'settings.title': 'Settings',
    'settings.preferences.language': 'Language',
    // Login page
    'login.title': 'Welcome Back',
    'login.subtitle': 'Sign in to <b>AlgoBucks</b>',
    'login.email': 'Email Address',
    'login.password': 'Password',
    'login.remember': 'Remember me',
    'login.forgot': 'Forgot password?',
    'login.submit': 'Sign In to AlgoBucks',
    'login.continue_with': 'Or continue with',
    'login.no_account': "Don't have an account?",
    'login.create_here': 'Create one here',
    'login.error.fill_all': 'Please fill in all fields',
    'login.error.invalid': 'Invalid email or password',
    'login.success': 'You have been successfully logged in.',
    // Common / Header / Footer
    'common.company': 'Company',
    'common.about': 'About',
    'common.about_us': 'About Us',
    'common.careers': 'Careers',
    'common.press': 'Press',
    'common.contact': 'Contact',
    'common.blog': 'Blog',
    'common.help_center': 'Help Center',
    'common.community': 'Community',
    'common.stay_connected': 'Stay Connected',
    'common.subscribe_newsletter': 'Subscribe Newsletter',
    'common.join_community': 'Join Community',
    'common.legal': 'Legal',
    'common.terms': 'Terms of Service',
    'common.privacy': 'Privacy Policy',
    'common.cookies': 'Cookie Policy',
    'common.all_rights_reserved': 'All rights reserved.',
    'auth.login': 'Log in',
    'auth.signup': 'Sign Up',
    'auth.create_free_account': 'Create Free Account',
    'user.your_profile': 'Your Profile',
    'user.settings': 'Settings',
    'user.admin_panel': 'Admin Panel',
    'user.admin': 'Admin',
    'user.sign_out': 'Sign out',
    'stats.coins': 'Coins',
    'stats.wallet': 'Wallet',
    'stats.points': 'Points',
  },
  hi: {
    'nav.home': 'मुखपृष्ठ',
    'nav.problems': 'समस्याएँ',
    'nav.contests': 'प्रतियोगिताएँ',
    'nav.discuss': 'चर्चा',
    'nav.leaderboard': 'लीडरबोर्ड',
    'nav.company': 'कंपनी',
    'nav.contact': 'संपर्क',
    'nav.wallet': 'वॉलेट',
    'settings.title': 'सेटिंग्स',
    'settings.preferences.language': 'भाषा',
    // Login page
    'login.title': 'वापसी पर स्वागत है',
    'login.subtitle': '<b>AlgoBucks</b> में साइन इन करें',
    'login.email': 'ईमेल पता',
    'login.password': 'पासवर्ड',
    'login.remember': 'मुझे याद रखें',
    'login.forgot': 'पासवर्ड भूल गए?',
    'login.submit': 'AlgoBucks में साइन इन करें',
    'login.continue_with': 'या जारी रखें',
    'login.no_account': 'खाता नहीं है?',
    'login.create_here': 'यहाँ बनाएँ',
    'login.error.fill_all': 'कृपया सभी फ़ील्ड भरें',
    'login.error.invalid': 'अमान्य ईमेल या पासवर्ड',
    'login.success': 'आप सफलतापूर्वक लॉग इन हो गए हैं।',
    // Common / Header / Footer
    'common.company': 'कंपनी',
    'common.about': 'परिचय',
    'common.about_us': 'हमारे बारे में',
    'common.careers': 'करियर',
    'common.press': 'प्रेस',
    'common.contact': 'संपर्क',
    'common.blog': 'ब्लॉग',
    'common.help_center': 'सहायता केंद्र',
    'common.community': 'समुदाय',
    'common.stay_connected': 'जुड़े रहें',
    'common.subscribe_newsletter': 'न्यूज़लेटर सदस्यता लें',
    'common.join_community': 'समुदाय से जुड़ें',
    'common.legal': 'कानूनी',
    'common.terms': 'सेवा की शर्तें',
    'common.privacy': 'गोपनीयता नीति',
    'common.cookies': 'कुकी नीति',
    'common.all_rights_reserved': 'सर्वाधिकार सुरक्षित।',
    'auth.login': 'लॉग इन',
    'auth.signup': 'साइन अप',
    'auth.create_free_account': 'मुफ्त खाता बनाएं',
    'user.your_profile': 'आपकी प्रोफ़ाइल',
    'user.settings': 'सेटिंग्स',
    'user.admin_panel': 'एडमिन पैनल',
    'user.admin': 'एडमिन',
    'user.sign_out': 'साइन आउट',
    'stats.coins': 'कॉइन्स',
    'stats.wallet': 'वॉलेट',
    'stats.points': 'अंक',
  },
  es: {
    'nav.home': 'Inicio',
    'nav.problems': 'Problemas',
    'nav.contests': 'Concursos',
    'nav.discuss': 'Debate',
    'nav.leaderboard': 'Clasificación',
    'nav.company': 'Compañía',
    'nav.contact': 'Contacto',
    'nav.wallet': 'Billetera',
    'settings.title': 'Configuración',
    'settings.preferences.language': 'Idioma',
    // Login page
    'login.title': 'Bienvenido de nuevo',
    'login.subtitle': 'Inicia sesión en <b>AlgoBucks</b>',
    'login.email': 'Correo electrónico',
    'login.password': 'Contraseña',
    'login.remember': 'Recuérdame',
    'login.forgot': '¿Olvidaste tu contraseña?',
    'login.submit': 'Iniciar sesión en AlgoBucks',
    'login.continue_with': 'O continúa con',
    'login.no_account': '¿No tienes una cuenta?',
    'login.create_here': 'Crea una aquí',
    'login.error.fill_all': 'Por favor completa todos los campos',
    'login.error.invalid': 'Correo o contraseña inválidos',
    'login.success': 'Has iniciado sesión correctamente.',
    // Common / Header / Footer
    'common.company': 'Compañía',
    'common.about': 'Acerca de',
    'common.about_us': 'Sobre nosotros',
    'common.careers': 'Empleos',
    'common.press': 'Prensa',
    'common.contact': 'Contacto',
    'common.blog': 'Blog',
    'common.help_center': 'Centro de ayuda',
    'common.community': 'Comunidad',
    'common.stay_connected': 'Mantente conectado',
    'common.subscribe_newsletter': 'Suscribirse al boletín',
    'common.join_community': 'Unirse a la comunidad',
    'common.legal': 'Legal',
    'common.terms': 'Términos de servicio',
    'common.privacy': 'Política de privacidad',
    'common.cookies': 'Política de cookies',
    'common.all_rights_reserved': 'Todos los derechos reservados.',
    'auth.login': 'Iniciar sesión',
    'auth.signup': 'Regístrate',
    'auth.create_free_account': 'Crear cuenta gratis',
    'user.your_profile': 'Tu perfil',
    'user.settings': 'Configuraciones',
    'user.admin_panel': 'Panel de administración',
    'user.admin': 'Admin',
    'user.sign_out': 'Cerrar sesión',
    'stats.coins': 'Monedas',
    'stats.wallet': 'Billetera',
    'stats.points': 'Puntos',
  },
  fr: {
    'nav.home': 'Accueil',
    'nav.problems': 'Problèmes',
    'nav.contests': 'Concours',
    'nav.discuss': 'Discussion',
    'nav.leaderboard': 'Classement',
    'nav.company': 'Entreprise',
    'nav.contact': 'Contact',
    'nav.wallet': 'Portefeuille',
    'settings.title': 'Paramètres',
    'settings.preferences.language': 'Langue',
    // Login page
    'login.title': 'Bon retour',
    'login.subtitle': 'Connectez-vous à <b>AlgoBucks</b>',
    'login.email': 'Adresse e-mail',
    'login.password': 'Mot de passe',
    'login.remember': 'Se souvenir de moi',
    'login.forgot': 'Mot de passe oublié ?',
    'login.submit': "Se connecter à AlgoBucks",
    'login.continue_with': 'Ou continuer avec',
    'login.no_account': "Vous n'avez pas de compte ?",
    'login.create_here': 'Créez-en un ici',
    'login.error.fill_all': 'Veuillez remplir tous les champs',
    'login.error.invalid': 'E-mail ou mot de passe invalide',
    'login.success': 'Connexion réussie.',
    // Common / Header / Footer
    'common.company': 'Entreprise',
    'common.about': 'À propos',
    'common.about_us': 'À propos de nous',
    'common.careers': 'Carrières',
    'common.press': 'Presse',
    'common.contact': 'Contact',
    'common.blog': 'Blog',
    'common.help_center': 'Centre d’aide',
    'common.community': 'Communauté',
    'common.stay_connected': 'Restez connecté',
    'common.subscribe_newsletter': 'S’abonner à la newsletter',
    'common.join_community': 'Rejoindre la communauté',
    'common.legal': 'Mentions légales',
    'common.terms': 'Conditions d’utilisation',
    'common.privacy': 'Politique de confidentialité',
    'common.cookies': 'Politique de cookies',
    'common.all_rights_reserved': 'Tous droits réservés.',
    'auth.login': 'Se connecter',
    'auth.signup': 'S’inscrire',
    'auth.create_free_account': 'Créer un compte gratuit',
    'user.your_profile': 'Votre profil',
    'user.settings': 'Paramètres',
    'user.admin_panel': 'Panneau d’administration',
    'user.admin': 'Admin',
    'user.sign_out': 'Se déconnecter',
    'stats.coins': 'Pièces',
    'stats.wallet': 'Portefeuille',
    'stats.points': 'Points',
  },
  de: {
    'nav.home': 'Startseite',
    'nav.problems': 'Aufgaben',
    'nav.contests': 'Wettbewerbe',
    'nav.discuss': 'Diskutieren',
    'nav.leaderboard': 'Bestenliste',
    'nav.company': 'Unternehmen',
    'nav.contact': 'Kontakt',
    'nav.wallet': 'Wallet',
    'settings.title': 'Einstellungen',
    'settings.preferences.language': 'Sprache',
    // Login page
    'login.title': 'Willkommen zurück',
    'login.subtitle': 'Bei <b>AlgoBucks</b> anmelden',
    'login.email': 'E-Mail-Adresse',
    'login.password': 'Passwort',
    'login.remember': 'Angemeldet bleiben',
    'login.forgot': 'Passwort vergessen?',
    'login.submit': 'Bei AlgoBucks anmelden',
    'login.continue_with': 'Oder fortfahren mit',
    'login.no_account': 'Noch kein Konto?',
    'login.create_here': 'Hier erstellen',
    'login.error.fill_all': 'Bitte alle Felder ausfüllen',
    'login.error.invalid': 'Ungültige E-Mail oder Passwort',
    'login.success': 'Sie wurden erfolgreich angemeldet.',
    // Common / Header / Footer
    'common.company': 'Unternehmen',
    'common.about': 'Über',
    'common.about_us': 'Über uns',
    'common.careers': 'Karriere',
    'common.press': 'Presse',
    'common.contact': 'Kontakt',
    'common.blog': 'Blog',
    'common.help_center': 'Hilfe-Center',
    'common.community': 'Community',
    'common.stay_connected': 'Verbunden bleiben',
    'common.subscribe_newsletter': 'Newsletter abonnieren',
    'common.join_community': 'Community beitreten',
    'common.legal': 'Rechtliches',
    'common.terms': 'Nutzungsbedingungen',
    'common.privacy': 'Datenschutzerklärung',
    'common.cookies': 'Cookie-Richtlinie',
    'common.all_rights_reserved': 'Alle Rechte vorbehalten.',
    'auth.login': 'Anmelden',
    'auth.signup': 'Registrieren',
    'auth.create_free_account': 'Kostenloses Konto erstellen',
    'user.your_profile': 'Dein Profil',
    'user.settings': 'Einstellungen',
    'user.admin_panel': 'Admin-Bereich',
    'user.admin': 'Admin',
    'user.sign_out': 'Abmelden',
    'stats.coins': 'Münzen',
    'stats.wallet': 'Wallet',
    'stats.points': 'Punkte',
  },
};

interface I18nContextValue {
  lang: LangCode;
  setLanguage: (lang: LangCode) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

export const I18nProvider: React.FC<{ initialLang?: LangCode; children: React.ReactNode }> = ({ initialLang, children }) => {
  const [lang, setLang] = useState<LangCode>(() => {
    const saved = (localStorage.getItem('lang') as LangCode | null) || undefined;
    return initialLang || saved || 'en';
  });

  useEffect(() => {
    localStorage.setItem('lang', lang);
    try {
      document.documentElement.lang = lang;
    } catch {}
  }, [lang]);

  const t = useMemo(() => {
    const dict = dictionaries[lang] || dictionaries.en;
    return (key: string) => dict[key] ?? key;
  }, [lang]);

  const setLanguage = (next: LangCode) => setLang(next);

  const value: I18nContextValue = { lang, setLanguage, t };
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}
